//Jenkinsfile

try {

  stage('testing')
    node {
    echo "Testing the pipeline"
    }

  stage('checkout') {
      node {
        cleanWs()
        checkout scm
      }
  }


  stage('init') {
    node {  
      withCredentials([
        azureServicePrincipal('azserviceprincipal')]) {
          ansiColor('xterm') {
          sh 'terraform init'
          }     
         }
        }  
      }
      
      
      stage('create workspace') {
    node {  
      withCredentials([
        azureServicePrincipal('azserviceprincipal')]) {
          ansiColor('xterm') {
          sh 'terraform workspace new "Dummy"'
          }     
         }
        }  
       }
}
catch (org.jenkinsci.plugins.workflow.steps.FlowInterruptedException flowError) {
  currentBuild.result = 'ABORTED'
}
catch (err) {
  currentBuild.result = 'FAILURE'
  throw err
}
finally {
  if (currentBuild.result == 'SUCCESS') {
    currentBuild.result = 'SUCCESS'
  }
}
